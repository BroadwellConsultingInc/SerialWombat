<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Serial Wombat 4A and 4B Firmware: quadEnc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="red&whitetorso.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Serial Wombat 4A and 4B Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a058f16d05eaa2bc6865aceaf1b7cf68.html">Wombat16F15214.X</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">quadEnc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="serial_wombat_8h_source.html">serialWombat.h</a>&quot;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structquad_enc__n.html">quadEnc_n</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a180d506dbf29df0ea63be9f77d4c222a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="quad_enc_8c.html#a180d506dbf29df0ea63be9f77d4c222a">quadEnc</a>&#160;&#160;&#160;((<a class="el" href="quad_enc_8c.html#a702bd5c31835e63ad468eed34038781f">quadEnc_t</a>*) <a class="el" href="pin_registers_8h.html#a746aa3c2d8a5e19351392e2aa0e1f8d0">CurrentPinRegister</a>)</td></tr>
<tr class="separator:a180d506dbf29df0ea63be9f77d4c222a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a702bd5c31835e63ad468eed34038781f"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structquad_enc__n.html">quadEnc_n</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="quad_enc_8c.html#a702bd5c31835e63ad468eed34038781f">quadEnc_t</a></td></tr>
<tr class="separator:a702bd5c31835e63ad468eed34038781f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aec23a06fd2f1d9a94642d7b6a802d8d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="quad_enc_8c.html#aec23a06fd2f1d9a94642d7b6a802d8d3">initQuadEnc</a> (void)</td></tr>
<tr class="separator:aec23a06fd2f1d9a94642d7b6a802d8d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fc6aee25058c05f60326b8b84228dcf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="quad_enc_8c.html#a0fc6aee25058c05f60326b8b84228dcf">update_quadEnc</a> (void)</td></tr>
<tr class="memdesc:a0fc6aee25058c05f60326b8b84228dcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Periodic call to service the Quadrature Encoder decoder State Machine for a pin.  <a href="quad_enc_8c.html#a0fc6aee25058c05f60326b8b84228dcf">More...</a><br /></td></tr>
<tr class="separator:a0fc6aee25058c05f60326b8b84228dcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:abe9eed978726939153b6a751574d3654"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="quad_enc_8c.html#abe9eed978726939153b6a751574d3654">copy_IOC_PortBuffer</a> [<a class="el" href="device_specific_8h.html#ac73a0ff768b8975454391a08cda4360f">IOC_BUFFER_SIZE</a>]</td></tr>
<tr class="separator:abe9eed978726939153b6a751574d3654"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the Quadrature Encoder pin mode for the Serial Wombat 4A and 4B</p>
<p>This file contains the Watchdog pin mode for the Serial Wombat 4A and 4B </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a180d506dbf29df0ea63be9f77d4c222a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a180d506dbf29df0ea63be9f77d4c222a">&#9670;&nbsp;</a></span>quadEnc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define quadEnc&#160;&#160;&#160;((<a class="el" href="quad_enc_8c.html#a702bd5c31835e63ad468eed34038781f">quadEnc_t</a>*) <a class="el" href="pin_registers_8h.html#a746aa3c2d8a5e19351392e2aa0e1f8d0">CurrentPinRegister</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a702bd5c31835e63ad468eed34038781f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a702bd5c31835e63ad468eed34038781f">&#9670;&nbsp;</a></span>quadEnc_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structquad_enc__n.html">quadEnc_n</a> <a class="el" href="quad_enc_8c.html#a702bd5c31835e63ad468eed34038781f">quadEnc_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aec23a06fd2f1d9a94642d7b6a802d8d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec23a06fd2f1d9a94642d7b6a802d8d3">&#9670;&nbsp;</a></span>initQuadEnc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initQuadEnc </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">\brief Initialization routine for Quadrature Encoder pin mode
</pre><hr  />
<h2><a class="anchor" id="autotoc_md52"></a>
Retrevial of Quadrature Encoder Position Value</h2>
<p>Configure the QuadEnc pin mode using the CONFIGURE_CHANNEL_MODE_0 command before reading values. <br  />
 The Quadrature Encoder Position value is stored in the Primary Pin's 16-bit Public data area. Use the Read Pin Buffer command to retreive it.</p>
<p>The Position value is a 16-bit unsigned number. Transitions that decrement a value of 0 will roll over to 65535. Transitions which incrment a value of 65535 will roll over to 0. <br  />
</p>
<hr  />
<h2><a class="anchor" id="autotoc_md54"></a>
CONFIGURE_CHANNEL_MODE_0:</h2>
<p>Initialize Quadrature Encoder Reader.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">BYTE 0 </th><th class="markdownTableHeadLeft">BYTE 1 </th><th class="markdownTableHeadLeft">BYTE 2 </th><th class="markdownTableHeadLeft">BYTE 3 </th><th class="markdownTableHeadLeft">BYTE 4 </th><th class="markdownTableHeadLeft">BYTE 5 </th><th class="markdownTableHeadLeft">BYTE 6 </th><th class="markdownTableHeadLeft">BYTE 7  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0xC0 </td><td class="markdownTableBodyLeft">Pin To Set </td><td class="markdownTableBodyLeft">0x05 (Quadrature Encoder) </td><td class="markdownTableBodyLeft">Debounce Frames (low byte) </td><td class="markdownTableBodyLeft">Debounce Frames (high byte, ignored) </td><td class="markdownTableBodyLeft">Second Pin Number </td><td class="markdownTableBodyLeft">Read State (0,1,2,4,5 or 6) </td><td class="markdownTableBodyLeft">0: Pull ups off, 1: Pull ups on  </td></tr>
</table>
<p>Read State Values:</p>
<p>0 = Read on Primary Pin High to Low transition, sampled with interrupts</p>
<p>1 = Read on Primary Pin Low to High transition, sampled with interrupts</p>
<p>2 = Read on Both transitions, sampled with interrupts</p>
<p>4 = Read on Primary Pin High to Low transition, polled every 1mS frame</p>
<p>5 = Read on Primary Pin Low to High transition, polled every 1mS frame</p>
<p>6 = Read on Both transitions, polled every 1mS frame</p>
<p>Response:</p>
<p>Command is echoed back.</p>
<p>Examples:</p>
<p>Set pins 1 (primary) and 2 (secondary) to quadrature encoder reading, 10 mS of debounce, Pull ups on, Read both transitions in polled mode</p>
<blockquote class="doxtable">
<p><code>0xC0 0x01 0x05 0x0A 0x00 0x02 0x06 0x01</code> </p>
</blockquote>

</div>
</div>
<a id="a0fc6aee25058c05f60326b8b84228dcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fc6aee25058c05f60326b8b84228dcf">&#9670;&nbsp;</a></span>update_quadEnc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_quadEnc </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Periodic call to service the Quadrature Encoder decoder State Machine for a pin. </p>
<p>This State machine monitors inputs from two pins (Primary and Secondary) to increment or decrement a counter based on transitions of a rotary encoder.</p>
<p>This State machine is called every 1 mS by the executive when the Primary pin is serviced. Initialization of this state machine sets the secondary pin mode to PIN_MODE_CONTROLLED, which is not serviced by the executive.</p>
<p>The quadrature encoder monitors the state of the Primary and Secondary pins via either polling (the pins are read when the state machine is serviced) or via interrupt when a change is state on the Primary pin is detected, at which time the state of both pins is recorded and saved for later processing when the state machine is serivced.</p>
<p>Saved interrupt transitions are stored in copy_IOC_PortBuffer, which is an array which is copied once for all pins from a similar interrupt modified array just prior to beginning the pin-servicing process every 1 mS. copy_IOC_PortBuffer stores the state of all 4 SW pins whenever an interrupt-on-change occurs. The array is initialized to 0xFF. Any interrupt on change sets the most significant bit of the value to 0 indicating that the element has new data. The array is filled from end to start so that incrementing indexing gets events as they happened in chronological order. Unused elements are therefore at the beginning of the array.</p>
<p>The update routine first looks to see if transitions are ignored due to being in a debounce period. If so, it decrements the debounce counter and returns.</p>
<p>If not in debounce, the state machine either samples and processes the primary pin state, or iterates through the copy_IOC_PortBuffer looking for transitions of the primary pin. <br  />
</p>
<p>When a transition that is relevant based on readState occurs, the state of the second pin is checked against the primary pin. If they are the same the position counter is incremented. If they are different, then the position counter is decremented. The debounce counter is then set to the configured value. If the debounce counter is &gt;0 and interrupt processing is occuring then the remainder of interrupts during that service are ignored. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="abe9eed978726939153b6a751574d3654"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe9eed978726939153b6a751574d3654">&#9670;&nbsp;</a></span>copy_IOC_PortBuffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t copy_IOC_PortBuffer[<a class="el" href="device_specific_8h.html#ac73a0ff768b8975454391a08cda4360f">IOC_BUFFER_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
