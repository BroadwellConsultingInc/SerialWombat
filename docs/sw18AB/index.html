<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Serial Wombat 18AB Firmware: Serial Wombat</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="red&whitetorso.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Serial Wombat 18AB Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Serial Wombat </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md14"></a>
What's a Serial Wombat?</h1>
<p>A Serial Wombat:</p>
<ul>
<li>Is a microcontroller programmed with custom, open-source firmware</li>
<li>Connects to a PC, Raspberry Pi, Arduino, or other "Smart" Host device through a UART or I2C connection</li>
<li>Acts as "Arms and Legs" by giving the host device Digital and Analog I/O capabilities</li>
<li>Uses a simple 8 byte protocol</li>
<li>Is designed to be attached to the host device during operation</li>
<li>Provides up to 19 digial I/O pins (Pic24FJ256GA702 version)</li>
<li>Provides up to 10 Analog Inputs</li>
<li>Runs on 3.3V, but also has a few 5v Tolerant inputs, including UART RX</li>
<li>Comes pre-programmed. You don't download any program to the Wombat; you send it commands in real-time</li>
<li>Includes functions to reduce the work of the host device, including servo control, stepper motor control, LCD display control, keypad scanning, filtering, averaging, rotary-encoder and many other pin-modes.</li>
<li>Can be upgraded by the user when new firmware comes out using a bootloader</li>
</ul>
<p>The Serial Wombat is a 28 pin, Microchip 24FJ256GA702 PIC which comes preprogrammed with firmware to solve many common interface problems. The Serial Wombat makes it easy for people to interface things to their computer without ever programming a byte of code into a microcontroller. It makes it easy to add IO to devices with limited inputs and outputs, such as inexpensive ESP-01 ESP8266 based boards. It talks to the host via UART or I2c.</p>
<p>See the principles section of the Overview page for more detail on the ideas which drove the creation of the Serial Wombat.</p>
<p>The Serial Wombat makes it easy to write software to do more complicated things which can only be achieved on a PC with the help of embedded firmware. <br  />
</p>
<p>If you're using an Arduino or Raspberry Pi, this same embedded firmware can handle I/O focused tasks leaving your main program free to worry about higher level logic.</p>
<p>For instance, you could simultaneously:</p><ul>
<li>Control up to 19 Servos from the host computer, or set up a servo to respond to other Wombat inputs</li>
<li>Scan a matrix encoded keypad, and report and remember button pushes for reporting to the host</li>
<li>Monitor a rotary encoder and report the net number of clockwise or counterclockwise turns to the host</li>
<li>Configure the Wombat to monitor for short circuits of a FET driver and shut off an output within milliseconds of a short condition, preventing damage</li>
</ul>
<p>The Serial Wombat has a built in bootloader. This means that when a new version of firmware comes out, you can download it into the chip yourself without needing an embedded programmer.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Serial Wombat Overview</h1>
<p>The Serial Wombat is designed to provide low-to-medium speed Digital I/O (up to about 50kHz) and analog to digital data aquisition, while taking advantage of the potential available in an external microcontroller.</p>
<p>The Serial Wombat's internal firmware does a lot more than just set pins high or low. Each pin is assigned an independed state machine capable of doing lots of different things, which preprocess data or manipulate outputs to achieve higher level functionality on behalf of the host.</p>
<ul>
<li>Why waste precious bandwidth sending data from a device to its host when this data will simply be averaged or filtered when it gets there? Filtering and averaging should often be done before data is sent to the host.</li>
<li>Why make decisions on the host which could be made faster and more efficiently on the microcontroller? For example, if a temperature of an aquarium is being controlled by a heater and a host, there are two ways this could be done:<ul>
<li>The host could constantly ask the Wombat what the temperature of the aquarium is, then tell the Wombat to turn on or turn off the heater accordingly. This method uses lots of bandwidth over the serial link, and may kill your tropical fish if your host crashes or locks up.</li>
</ul>
</li>
</ul>
<p>Or....The host can tell the Wombat, "Wombat, please set pin number 6 as a digital output. Set it high when the voltage on pin 2 (from a temperature sensor) drops below 350, and set it low when the voltage rises above 400."; The Wombat will then take responsibility for holding the temperature between 350 and 400. This can be done with a couple of simple serial commands.</p><ul>
<li>Some events happen too fast to be communicated in real-time to the host. For example, a rotary encoder knob (such as the ones on many car radios) which is turned by a human typically can change states at around every 500 microseconds. This is far too often to be polled by the host. However, it can be easily monitored by the Wombat. The Wombat then simply tells the host the net number of "clicks" clockwise or counter-clockwise have happened since the last time the host asked.</li>
</ul>
<p>Many of these problems can also be solved by programming directly on an Arduino or Raspberry Pi. However, this often takes a substantial time investment, and may rely on libraries that are specific to a particular platform. The Serial Wombat is designed to allow many common embedded problems without needing a hardware specific library. The Wombat will work good with any platform that has a UART. Some problems, such as the Aquarium example above, can be solved by simply sending a few commands to the Wombat from a terminal such as Putty or Hyperterminal.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Principals</h1>
<p>The Serial Wombat design is based on the following principles:</p>
<ul>
<li>The communication protocol between the Serial Wombat and its host should be simple, efficient, and robust. Loss of synchronization with the host should be unlikely to cause incorrect commands to be executed. When synchronization is lost it should be detectable by the host after one command, and should be easily resynchronized.</li>
<li>The processing power of the microcontroller should be used to relieve the host of mundane tasks, and to make optimal use of host/Serial Wombat communication bandwidth.</li>
<li>As much as possible, every pin should be capable of every function (Digital I/O, pwm, frequency measurement, Analog/Digital conversion, communications). If functionality is not provided by microcontroller hardware resource for a given pin, then it should be implemented in software.</li>
<li>The user should require little to no understanding of the microcontroller inner workings to implement simple projects.Pins should be refered to by their pin number. The user should not have to distinguish between pins on different logical ports.</li>
<li>The user should be able to access as many of the microcontroller special hardware functions as possible. In some rare cases, this may require understanding of the microcontroller's special function registers. To borrow a quote from Perl, Easy things should be easy, and hard things should be possible.</li>
<li>The user should determine how to best use available memory and processor throughput The user should be able to determine the most desireable trade-off between pin sampling/update rate and CPU utilization/function complexity. However, most common uses should "Just Work" without futzing with this.</li>
<li>The Serial Wombat should make system level debugging as easy as possible. The ability to issue typed commands to the hardware through an ASCII terminal such as Windows Hyperterminal allows the user to manipulate hardware before application software is written. Comprehensive error checking, the availability of an Echo function, and access to numerous internal system state variables allows the user to quickly diagnose problems.</li>
<li>The Serial Wombat should use software as possible to eliminate physical components. Examples include digital filtering of analog inputs and debouncing of switch inputs, as well as ability to individually set internal pin pull-ups and pull-downs.</li>
<li>The Serial Wombat should be expandable. The user should be able to develop firmware to run in the microcontroller in partnership with the existing Serial Wombat pin modes.</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
Why the PIC24FJ256GA702?</h1>
<p>Of all of the microcontrollers in the world, why the PIC24FJ256GA702?</p>
<p>This micro has a few properties that make it particularly well suited to become the new Serial Wombat:</p>
<ul>
<li>It comes in multiple packages, including DIP. The 28 pin dip package makes it easy for people who like to build their own hardware, but are uncomfortable with surface mount soldering of IC's.</li>
<li>It's cheap. On microchip's site the DIP package is currently about 2 bucks, dropping down to $1.50 in quantity. SOIC's and QFN's are even a little bit cheaper.</li>
<li>Cheap, functional programming adapters avaialble to flash the Serial Wombat firmware into the chip. Aliexpress has PicKit3 knock-offs for about 10 bucks, shipped. I use one frequently.</li>
<li>3.3v operation, with 5v tolerant pins. This means that the Serial Wombat can communicate with nearly any Arduino device with a UART, since it's RX pin is directly 5v tollerant, and a 5V device will accept 3 v input. 5 additonal pins on the PIC24FJ256GA702 are 5v tollerant</li>
<li>Internal DMA capability - Many pin modes of the serial wombat rely on periodic, relatively high speed updates (57,600 updates per second). The use of timer based DMA allows the Serial Wombat to provide very precisely timed updates on all 19 pins.</li>
<li>10 pins have 12 bit A/D converters, and an internal bandgap reference allows measurement of supply voltage +/- 5%. <br  />
</li>
<li>Each digital IO pin can sink or source up to 25mA of current, with a cap of 200ma total for the entire chip.</li>
<li>Wide operating range of 2.2V to 3.6V</li>
<li>Peripheral Pin Select - This feature of a micro allows remapping of hardware peripherals from one pin to another. This allows, for instance, the hardware spi capability to be routed to selectable pins on the Serial Wombat. 14 of the Serial Wombat's 19 configurable pins have this function.</li>
<li>Microchip is better than most companies about not discontinuing aging products</li>
</ul>
<p>Among the concerns with this chip:</p>
<ul>
<li>No open source compiler</li>
<li>Requires a 10uF cap on vCAP, in addtion to typical .1uf Decoupling Caps </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
